Dealt with more malloc and free
